# Database Migration Guidelines

이 문서는 데이터베이스 스키마 및 데이터 변경을 형상 관리 원칙에 따라 안전하게 수행하기 위한 가이드라인입니다.

## 1. 핵심 원칙 (Core Principles)
1. **임의 수정 금지**: 운영/스테이징 DB 스키마를 직접(manual) 수정하지 않는다. 모든 변경은 코드를 통해 수행한다.
2. **형상 관리 준수**: 마이그레이션 스크립트는 Git 저장소에 포함되어 버전 관리되어야 한다.
3. **가역성 (Reversibility)**: 모든 마이그레이션은 원복 가능한 'Rollback' 스크립트를 수반해야 한다.
4. **순차성**: 마이그레이션은 타임스탬프 또는 순차적인 번호를 사용하여 순서가 보장되어야 한다.

## 2. 마이그레이션 절차
1. **제안**: RFC 또는 명세서(Specification)에서 데이터 모델 변경의 필요성을 논의한다.
2. **스크립트 작성**: 
   - `Up` (변경 적용) 및 `Down` (변경 원복) 스크립트를 쌍으로 작성한다.
   - 데이터 손실이 예상되는 경우(예: 컬럼 삭제) 백업 전략을 명세에 포함한다.
3. **로컬 검증**: 본인의 개발 환경에서 마이그레이션 및 롤백이 성공하는지 확인한다.
4. **스테이징 검증**: 실제 데이터와 유사한 환경에서 'Dry-run' 또는 테스트 실행을 완료한다.
5. **승인 후 적용**: 사용자의 최종 승인을 얻은 PR이 머지될 때 적용한다.

## 3. 형상 관리 규칙
- **파일명 규칙**: `YYYYMMDD_HHMMSS_description.ext` (예: `20260117_130000_add_user_table.sql`)
- **버전 태깅**: 코드 버전과 스키마 버전의 일관성을 유지한다.

---
**최종 업데이트**: 2026-01-17
